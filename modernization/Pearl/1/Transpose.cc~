// This code supplements the white paper
//    "Multithreaded Transposition of Square Matrices
//     with Common Code for 
//     Intel Xeon Processors and Intel Xeon Phi Coprocessors"
// available at the following URL:
//     http://research.colfaxinternational.com/post/2013/08/12/Trans-7110.aspx
// You are free to use, modify and distribute this code as long as you acknowledge
// the above mentioned publication.
// (c) Colfax International, 2013

#include "Transpose.h"
#include <cstdlib>
#include "advisor-annotate.h"

void Transpose(FTYPE* const A, const int n) {
  ANNOTATE_SITE_BEGIN( MySite1 );
  for (int j = 0; j < n; j++) {
    ANNOTATE_ITERATION_TASK( MyTask1 );
    ANNOTATE_SITE_BEGIN( MySite2 );
    for (int i = 0; i < j; i++) {
      ANNOTATE_ITERATION_TASK( MyTask2 );
      const FTYPE c = A[i*n + j];
      A[i*n + j] = A[j*n + i];
      A[j*n + i] = c;
    }
    ANNOTATE_SITE_END();
  }
  ANNOTATE_SITE_END();
}

